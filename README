This is for awesome 3.4.x, if you want to try this please apply patches to awesome first.
